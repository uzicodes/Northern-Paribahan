datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id         String   @id @default(uuid())
  email      String   @unique
  password   String
  name       String
  role       Role     @default(USER)
  bookings   Booking[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Bus {
  id         String   @id @default(uuid())
  name       String
  number     String   @unique
  route      Route    @relation(fields: [routeId], references: [id])
  routeId    String
  seats      Seat[]
  bookings   Booking[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Route {
  id         String  @id @default(uuid())
  origin     String
  destination String
  departure  DateTime
  arrival    DateTime
  buses      Bus[]
}

model Seat {
  id        String  @id @default(uuid())
  seatNumber String
  bus       Bus     @relation(fields: [busId], references: [id])
  busId     String
  isBooked  Boolean @default(false)
  booking   Booking?

  @@unique([busId, seatNumber])
}

model Booking {
  id        String  @id @default(uuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String
  bus       Bus     @relation(fields: [busId], references: [id])
  busId     String
  seat      Seat    @relation(fields: [seatId], references: [id])
  seatId    String  @unique
  status    BookingStatus @default(CONFIRMED)
  createdAt DateTime @default(now())
}

enum Role {
  USER
  ADMIN
}

enum BookingStatus {
  CONFIRMED
  CANCELED
}

